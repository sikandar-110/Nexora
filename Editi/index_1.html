<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Editor</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,sans-serif;user-select:none;-webkit-user-select:none;}
        body{background:#000;color:#fff;height:100vh;display:flex;flex-direction:column}
        .image-container{flex:1;display:flex;justify-content:center;align-items:center;background:#000;position:relative;overflow:hidden}
        #preview-image{max-width:100%;max-height:70vh;object-fit:contain;cursor:pointer;transition:filter 0.2s ease}
        .controls{background:#1c1c1e;padding:15px;border-radius:12px 12px 0 0;position:relative}
        .tools{display:flex;gap:12px;overflow-x:auto;padding:10px 0;margin-bottom:10px;-webkit-overflow-scrolling:touch}
        .tool{width:60px;height:60px;border-radius:12px;background:#2c2c2e;display:flex;flex-direction:column;justify-content:center;align-items:center;flex-shrink:0;cursor:pointer;transition:all 0.2s ease}
        .tool.active{background:#0a84ff;transform:scale(1.05)}
        .tool-icon{font-size:24px;margin-bottom:4px}
        .tool-name{font-size:11px;font-weight:500}
        .slider-container{margin-bottom:15px;padding:0 10px}
        .slider-label{display:flex;justify-content:space-between;margin-bottom:5px;font-size:13px}
        input[type=range]{width:100%;height:4px;-webkit-appearance:none;background:#3a3a3c;border-radius:2px}
        input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:#fff;border-radius:50%}
        .buttons{display:flex;gap:10px;margin-top:15px}
        .btn{flex:1;padding:12px;border-radius:8px;border:none;font-size:15px;cursor:pointer;font-weight:500}
        .upload-btn{background:#0a84ff;color:#fff}
        .download-btn{background:#34c759;color:#fff}
        .reset-btn{background:none;border:1px solid #636366;color:#fff}
        #file-input{display:none}
        .fullscreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:100;display:flex;justify-content:center;align-items:center}
        .fullscreen img{max-width:100%;max-height:100%;object-fit:contain}
        .original-indicator{position:absolute;top:10px;left:10px;background:rgba(0,0,0,0.7);padding:5px 10px;border-radius:20px;font-size:12px;display:none;z-index:10}
    </style>
</head>
<body>
    <div class="image-container">
        <img id="preview-image" src="data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='400' viewBox='0 0 300 400'%3E%3Crect width='300' height='400' fill='%23333'/%3E%3Ctext x='150' y='200' font-family='sans-serif' font-size='16' fill='%23ccc' text-anchor='middle'%3EUpload Image%3C/text%3E%3C/svg%3E" alt="Preview">
        <div class="original-indicator" id="original-indicator">Original</div>
    </div>

    <div class="controls">
        <div class="tools" id="tools"></div>
        <div class="slider-container">
            <div class="slider-label">
                <span id="current-tool">Select Tool</span>
                <span id="current-value">0</span>
            </div>
            <input type="range" id="slider" min="0" max="100" step="1" value="0" disabled>
        </div>
        <div class="buttons">
            <input type="file" id="file-input" accept="image/*">
            <button class="btn upload-btn" id="upload">Upload</button>
            <button class="btn download-btn" id="download">Download</button>
            <button class="btn reset-btn" id="reset">Reset</button>
        </div>
    </div>

    <script>
        // Tool configuration with icons and ranges (new order)
        const tools = [
            {id: "exposure", name: "Exposure", icon: "â˜€ï¸", min: -100, max: 100, step: 1, value: 0},
            {id: "brilliance", name: "Brilliance", icon: "âœ¨", min: -100, max: 100, step: 1, value: 0},
            {id: "highlights", name: "Highlights", icon: "ðŸ”…", min: -100, max: 100, step: 1, value: 0},
            {id: "shadows", name: "Shadows", icon: "ðŸŒ‘", min: -100, max: 100, step: 1, value: 0},
            {id: "contrast", name: "Contrast", icon: "â—", min: 50, max: 150, step: 1, value: 100},
            {id: "brightness", name: "Brightness", icon: "ðŸ”†", min: -100, max: 100, step: 1, value: 0},
            {id: "blackpoint", name: "Black Point", icon: "â¬›", min: -100, max: 100, step: 1, value: 0},
            {id: "saturation", name: "Saturation", icon: "ðŸŒˆ", min: 0, max: 200, step: 1, value: 100},
            {id: "vibrance", name: "Vibrance", icon: "ðŸŽ¨", min: -100, max: 100, step: 1, value: 0},
            {id: "warmth", name: "Warmth", icon: "ðŸ”¥", min: -100, max: 100, step: 1, value: 0},
            {id: "tint", name: "Tint", icon: "ðŸ–Œï¸", min: -100, max: 100, step: 1, value: 0},
            {id: "sharpness", name: "Sharpness", icon: "âœ‚ï¸", min: 0, max: 100, step: 1, value: 0},
            {id: "definition", name: "Definition", icon: "ðŸ”", min: -100, max: 100, step: 1, value: 0},
            {id: "noise", name: "Noise", icon: "ðŸŽ›ï¸", min: 0, max: 100, step: 1, value: 0},
            {id: "vignette", name: "Vignette", icon: "â­•", min: 0, max: 100, step: 1, value: 0}
        ];

        let currentValues = {};
        let originalImage = null;
        let activeTool = null;
        let originalImageData = null;
        let touchTimer = null;
        let isShowingOriginal = false;

        // Initialize editor
        function init() {
            // Create tools
            const toolsContainer = document.getElementById('tools');
            tools.forEach(tool => {
                // Initialize current values
                currentValues[tool.id] = tool.value;

                const toolEl = document.createElement('div');
                toolEl.className = 'tool';
                toolEl.dataset.tool = tool.id;
                
                const icon = document.createElement('div');
                icon.className = 'tool-icon';
                icon.textContent = tool.icon;
                
                const name = document.createElement('div');
                name.className = 'tool-name';
                name.textContent = tool.name;
                
                toolEl.appendChild(icon);
                toolEl.appendChild(name);
                toolsContainer.appendChild(toolEl);

                toolEl.addEventListener('click', () => {
                    document.querySelectorAll('.tool').forEach(t => t.classList.remove('active'));
                    toolEl.classList.add('active');
                    activeTool = tool.id;
                    setupSlider(tool);
                });
            });

            // Setup slider
            const slider = document.getElementById('slider');
            slider.addEventListener('input', (e) => {
                if (!activeTool) return;
                currentValues[activeTool] = parseFloat(e.target.value);
                document.getElementById('current-value').textContent = e.target.value;
                applyEffects();
            });

            // Image upload
            document.getElementById('upload').addEventListener('click', () => {
                document.getElementById('file-input').click();
            });

            document.getElementById('file-input').addEventListener('change', (e) => {
                if (e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        originalImage = event.target.result;
                        document.getElementById('preview-image').src = originalImage;
                        resetValues();
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });

            // Download
            document.getElementById('download').addEventListener('click', downloadImage);

            // Reset
            document.getElementById('reset').addEventListener('click', resetValues);

            // Fullscreen preview
            document.getElementById('preview-image').addEventListener('click', toggleFullscreen);

            // Hold to compare original
            const previewImage = document.getElementById('preview-image');
            previewImage.addEventListener('touchstart', startHold);
            previewImage.addEventListener('touchend', endHold);
            previewImage.addEventListener('mousedown', startHold);
            previewImage.addEventListener('mouseup', endHold);
            previewImage.addEventListener('mouseleave', endHold);
        }

        // Hold to compare functions
        function startHold() {
            if (!originalImage) return;
            touchTimer = setTimeout(() => {
                showOriginal();
                isShowingOriginal = true;
                document.getElementById('original-indicator').style.display = 'block';
            }, 300);
        }

        function endHold() {
            if (touchTimer) {
                clearTimeout(touchTimer);
                touchTimer = null;
            }
            if (isShowingOriginal) {
                showEdited();
                isShowingOriginal = false;
                document.getElementById('original-indicator').style.display = 'none';
            }
        }

        // Setup slider for selected tool
        function setupSlider(tool) {
            document.getElementById('current-tool').textContent = tool.name;
            document.getElementById('current-value').textContent = currentValues[tool.id];
            
            const slider = document.getElementById('slider');
            slider.min = tool.min;
            slider.max = tool.max;
            slider.step = tool.step;
            slider.value = currentValues[tool.id];
            slider.disabled = false;
        }

        // Apply all effects with iPhone-like adjustments
        function applyEffects() {
            const img = document.getElementById('preview-image');
            let filter = '';

            // Exposure - affects both highlights and shadows
            const exposureValue = (currentValues.exposure || 0)/100;
            filter += `brightness(${1 + exposureValue * 0.5}) contrast(${1 + exposureValue * 0.3}) `;
            
            // Brilliance - iPhone-like effect (combination of contrast and smart highlights)
            const brillianceValue = (currentValues.brilliance || 0)/100;
            filter += `contrast(${1 + brillianceValue * 0.5}) brightness(${1 + brillianceValue * 0.2}) saturate(${1 + brillianceValue * 0.3}) `;
            
            // Highlights - preserves highlights while brightening
            const highlightsValue = (currentValues.highlights || 0)/100;
            if (highlightsValue > 0) {
                filter += `brightness(${1 + highlightsValue * 0.3}) contrast(${1 - highlightsValue * 0.1}) `;
            } else {
                filter += `brightness(${1 + highlightsValue * 0.5}) `;
            }
            
            // Shadows - lifts shadows without overexposing
            const shadowsValue = (currentValues.shadows || 0)/100;
            if (shadowsValue > 0) {
                filter += `brightness(${1 + shadowsValue * 0.4}) contrast(${1 + shadowsValue * 0.2}) `;
            } else {
                filter += `brightness(${1 + shadowsValue * 0.3}) contrast(${1 + shadowsValue * 0.1}) `;
            }
            
            // Contrast - standard contrast adjustment
            filter += `contrast(${(currentValues.contrast || 100)/100}) `;
            
            // Brightness - overall brightness
            filter += `brightness(${1 + (currentValues.brightness || 0)/100}) `;
            
            // Black Point - affects the darkest areas
            const blackPointValue = (currentValues.blackpoint || 0)/100;
            filter += `brightness(${1 + blackPointValue * 0.3}) contrast(${1 + blackPointValue * 0.5}) `;
            
            // Color adjustments
            filter += `saturate(${(currentValues.saturation || 100)/100}) `;
            
            // Vibrance - smarter saturation that protects skin tones
            const vibranceValue = (currentValues.vibrance || 0)/100;
            filter += `saturate(${1 + vibranceValue * 0.7}) `;
            
            // Warmth - temperature adjustment
            const warmthValue = (currentValues.warmth || 0)/100;
            if (warmthValue > 0) {
                filter += `sepia(${warmthValue * 0.3}) hue-rotate(${warmthValue * 5}deg) `;
            } else {
                filter += `hue-rotate(${warmthValue * 3}deg) `;
            }
            
            // Tint - green/magenta shift
            filter += `hue-rotate(${(currentValues.tint || 0) * 0.9}deg) `;
            
            // Sharpness - edge enhancement
            if (currentValues.sharpness > 0) {
                const sharpnessValue = (currentValues.sharpness || 0)/100;
                filter += `contrast(${1 + sharpnessValue * 0.5}) `;
            }
            
            // Definition - clarity-like effect
            const definitionValue = (currentValues.definition || 0)/100;
            filter += `contrast(${1 + definitionValue * 0.3}) brightness(${1 - definitionValue * 0.1}) `;
            
            // Noise reduction (simulated)
            if (currentValues.noise > 0) {
                const blurValue = Math.max(0, 0.5 - (currentValues.noise || 0)*0.005);
                if (blurValue > 0) filter += `blur(${blurValue}px) `;
            }
            
            // Vignette - needs canvas for proper implementation
            if (currentValues.vignette > 0) {
                // This is a simple approximation
                filter += `brightness(${1 - (currentValues.vignette || 0)*0.003}) `;
            }

            img.style.filter = filter.trim();
        }

        // Show original image (for hold to compare)
        function showOriginal() {
            if (!originalImage) return;
            const img = document.getElementById('preview-image');
            originalImageData = img.style.filter;
            img.style.filter = 'none';
        }

        // Show edited image (after hold to compare)
        function showEdited() {
            if (!originalImage || !originalImageData) return;
            const img = document.getElementById('preview-image');
            img.style.filter = originalImageData;
        }

        // Reset all values
        function resetValues() {
            tools.forEach(tool => {
                currentValues[tool.id] = tool.value;
                if (activeTool === tool.id) {
                    document.getElementById('slider').value = tool.value;
                    document.getElementById('current-value').textContent = tool.value;
                }
            });
            
            applyEffects();
        }

        // Download image with canvas for better filter support
        function downloadImage() {
            if (!originalImage) {
                alert('Please upload an image first');
                return;
            }
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.filter = document.getElementById('preview-image').style.filter;
                ctx.drawImage(img, 0, 0);
                
                // Apply vignette if needed
                if (currentValues.vignette > 0) {
                    applyVignetteToCanvas(ctx, canvas.width, canvas.height, currentValues.vignette);
                }
                
                const link = document.createElement('a');
                link.download = 'edited-photo.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            };
            
            img.src = originalImage;
        }

        // Apply proper vignette effect to canvas
        function applyVignetteToCanvas(ctx, width, height, strength) {
            const gradient = ctx.createRadialGradient(
                width/2, height/2, Math.max(width, height)*0.4,
                width/2, height/2, Math.max(width, height)*0.8
            );
            const opacity = strength/100 * 0.7;
            gradient.addColorStop(0, `rgba(0, 0, 0, 0)`);
            gradient.addColorStop(1, `rgba(0, 0, 0, ${opacity})`);
            
            ctx.globalCompositeOperation = 'multiply';
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            ctx.globalCompositeOperation = 'source-over';
        }

        // Toggle fullscreen preview
        function toggleFullscreen() {
            if (!originalImage || isShowingOriginal) return;
            
            const fs = document.createElement('div');
            fs.className = 'fullscreen';
            
            const img = document.createElement('img');
            img.src = document.getElementById('preview-image').src;
            img.style.filter = document.getElementById('preview-image').style.filter;
            
            fs.appendChild(img);
            document.body.appendChild(fs);
            
            fs.addEventListener('click', () => {
                document.body.removeChild(fs);
            });
        }

        // Initialize editor
        init();
    </script>
</body>
</html>